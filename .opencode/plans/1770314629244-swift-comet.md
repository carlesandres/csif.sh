# Plan: Commit Changes with Context Efficiency

## Status
Phase 4: Final Plan

## Objective
Create a git commit for the Astro → Next.js migration without loading all changes into context at once.

## Current State
- **Branch**: `migrate-site-to-nextjs`
- **15 files changed**: 6,390 insertions, 4,355 deletions
- **Nothing staged** yet
- **Change types**:
  - 8 Astro files deleted (old framework)
  - 8 Next.js files/dirs added (new framework)
  - 7 config files modified

## User Decision
- Single atomic commit for entire migration

## Implementation Plan

### Step 1: Stage Files Efficiently
Instead of `git add .`, stage files by category to avoid loading unnecessary context:

```bash
# Stage deletions (Astro removal)
git add -u

# Stage new Next.js files
git add .opencode/ next.config.ts eslint.config.mjs components.json postcss.config.mjs src/

# Stage config modifications
git add .gitignore README.md package.json package-lock.json tsconfig.json
```

This approach stages files without requiring full diffs to be loaded into context.

### Step 2: Verify Staging
Run `git status` to confirm all 15 files are staged correctly.

### Step 3: Create Commit
Based on repo's commit message style (seen in git log):
- Format: `<type>: <description>`
- Type should be `refactor` (framework migration)
- Keep concise and action-oriented

**Proposed commit message:**
```
refactor: migrate site from Astro to Next.js

- Remove Astro framework files and configuration
- Add Next.js 15 with App Router structure
- Update dependencies and build tooling
- Maintain existing site functionality
```

### Step 4: Post-Commit Verification
Run `git status` to confirm clean working tree and successful commit.

## Critical Files
- `.gitignore` - Updated for Next.js build artifacts
- `package.json` - Dependency changes (Astro → Next.js)
- `next.config.ts` - New Next.js configuration
- `src/app/` - New Next.js App Router structure

## Verification Steps
1. Confirm all 15 files are staged with `git status`
2. Verify commit created successfully with `git log -1`
3. Check working tree is clean with `git status`

## Context Efficiency Notes
- Using `git add` with specific paths avoids loading full diffs
- Not reading individual file contents for commit (unnecessary)
- Only using summary commands (`git status`, `git diff --stat`)
